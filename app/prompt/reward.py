SYSTEM_PROMPT = (
    "你是一个模型评估专家。现在有一个模型需要你来评估，该模型会根据用户的需求，生成推荐方案。请你分析用户的需求，全面严谨地判断模型提供的方案是否合理。"
)

from datetime import datetime
# 获取当前时间
now = datetime.now()

# 格式化为 YYYY-MM-DD HH:MM:SS
formatted_time = now.strftime("%Y-%m-%d %H:%M:%S")

from typing import List, Dict
import json

# 示例评估标准（需求修改）
EVALUATION_CRITERIA = {
    "完整度": {
        "weight": 0.2,
        "description": "判断方案是否完整（1-5分）",
        "rubric": {
            "1": "存在明显的规划漏洞，缺少关键环节",
            "3": "较为完整，但需要优化",
            "5": "是完整的出行规划（因为工具原因导致无法给出完整的行程规划并通过询问或者解释告知用户，也视作完整）"
        }
    },
    "合理性": {
        "weight": 0.2,
        "description": "方案在时间线上规划的逻辑是否合理，市内接驳/中转/转场，是否最大程度的满足用户的出行需求与约束，考虑到出行舒适度，符合旅行计划的常识（1-5分）",
        "rubric": {
            "1": "存在明显的时间冲突，或不合理的行程安排",
            "3": "基本合理，但有优化空间",
            "5": "时间安排完全合理，符合需求，并考虑到舒适度 （如果客观限制无法满足说明情况也算满足需求）"
        }
    },
    "约束性": {
        "weight": 0.2,
        "description": "请检查用户是否有特定约束，如交通工具类型，避开的地点航司，费用等，如果有的话需求是否满足（1-5分）",
        "rubric": {
            "1": "完全不符合用户约束",
            "3": "基本符合用户约束，但有部分需要优化",
            "5": "完全符合 （如果客观限制无法满足说明情况也算满足需求）"
        }
    },
    "需求完成度": {
        "weight": 0.2,
        "description": "请检查用户是否有特定需求，如停留时间，要经历的景点，需要完成的活动（美食， 探店等），如果有的话需求是否满足（1-5分）",
        "rubric": {
            "1": "完全不满足用户需求",
            "3": "基本满足用户需求，但有部分需要优化",
            "5": "完全满足（如果客观限制无法满足说明情况也算满足需求）"
        }
    },
    "灵活性": {
        "weight": 0.2,
        "description": "请你首先判断是否有突发情况的可能性，例如恶劣天气/时间限制/机票酒店住宿资源紧张等，如果有突发情况发生的可能的话，是否提供了备选方案（1-5分）",
        "rubric": {
            "1": "没有备选方案",
            "3": "有备选方案，但不够充分",
            "5": "充分考虑了备选方案"
        }
    }

}


def build_evaluation_prompt(solution: str, criteria: Dict) -> str:
    """构建结构化评估Prompt"""
    criteria_text = "\n".join(
        f"{k}: {v['description']}\n评分标准: {json.dumps(v['rubric'], indent=2, ensure_ascii=False)}"
        for k, v in criteria.items()
    )

    return f"""
严格按以下评估标准，评估方案并给出JSON格式结果：

# 评估标准
{criteria_text}

# 待评估方案
{solution}

# 输出要求
1. 对每个维度按1-5分整数打分
2. 计算加权得分，分数权重分别为 完整度：0.2，合理性：0.2，约束性：0.2，需求完成度：0.2，灵活性：0.2
3. 必须返回严格JSON格式：
{{
  "scores": {{
    "完整度": 分数,
    "合理性": 分数,
    "约束性": 分数,
    "需求完成度": 分数,
    "灵活性": 分数
  }},
  "weighted_total": 计算加权总分
  "comments": "评语"
}}

现在开始评估（只返回JSON，不要额外文字）：
"""
